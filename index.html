<!DOCTYPE HTML>
<html lang="en">
<head>
	<title>Ultimate Tic Tac Toe</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
<!--- 

Author(s): Jeff Pottruff
Version: 1.0
Date created: June 2 2017
Last updated: June 9 2017
Description: 

IMPORTANT NOTE: Layout for HTML and CSS taken from parts of http://bajcar.dev.fast.sheridanc.on.ca/www10049/class_examples/responsive_design/flex_tictac.html with permission from instructor

Creating a playable ultimate tic-tac-toe game

Basics:
Rules:
1) Player X can place their first move anywhere on the board (in any of the spaces, on any of the smaller boards)
2) The next player (O, in this case) must play in the grid on the larger board that corresponds with the last players move on the smaller board;

Example with coordinates:

00 01 02
10 11 12
20 21 22

- If X plays in space 02 on the small board, O must place their next move on the small board located in 02 of the large board;

- If O then places their token on 20 of the small board, X must place their next token on the small board located in 20 of the large board

note: the placement of tokens on the small board is up to the player, but which small board that player can play on is determined by the last player's move
note2: if corresponding cell's game is over, does the next player get to pick a new large cell?? (TODO: clairify this rule)
	OPTION2: current player can always pick large cell (note: FIXME: this is how game is currently set up, but not how it should be played)


Outcomes:
Small Board
1) Player X takes the small board, large cell changes to "X", DONE
2) Player O takes the small board, large cell changes to "O", DONE
3) The players tie, large cell changes to "-"

Large Board
1) Player X wins, corresponding winning message is dispalyed
2) Player O wins, corresponding winning message is dispalyed
3) It is a draw, corresponding message is dispalyed


TODO Checklist:
1) Add highlighting to large cell that is currently selected, DONE
2) Display finished games on large board as X, O, or - (blocked), DONE
3) Add functionality so player is automatically moved to next square based on last players move, TODO
	(ALSO SEE: FIXME checklist)
4) Add functionality to play/reset button, TODO
	(NOTE: cannot do largeCheckWin function is fixed)
5) Make Responsive, IMPROVE	(landscape - bottom of table tends to get cut off)

Optional TODO:
1) Improve CSS - make look better in general, TODO


FIXME Checklist:
1) Add somethign that ensures when user clicks on a large cell that has previously been clicked the small cell will not be selected until user clicks on it
	(ie. first click large cell, then click small cell - something buggy is happening after a large cell has already been used once)
	OR send user to largecell that correpsonds with user's last move
		SEE: clickLarge fucntion

2) fix largeCheckWin function - not picking up winning combos or draws on large board



Validation:

HTML: DONE
CSS: DONE
JavaScript: DONE




-->
<!-- ***CSS*** -->

<style>
header {
	text-align: center;
	width: 100%;
}
main {
	text-align: center;
	width: 100%;
}
table {
	margin: auto;
	padding: 5px;
	background-color: white;
	color: navy;
	font-family: Helvetica,Arial,"Lucida Grande",sans-serif;
}
table.smallBoard {
	background-color: transparent;
}
td {
	height: 2em;
	width: 7em;
	font-size: 1em;
	font-family: sans-serif;
	border: 1px solid #00f;
	background-color: transparent;
}
td:nth-child(1) {
	border-left-style: none;
}

td:nth-child(3) {
	border-right-style: none;
}

tr:nth-child(1)>td {
	border-top-style: none;
}

tr:nth-child(3)>td {
	border-bottom-style: none;
}

address {
	text-align: center;
}

span.largeToken {
	font-size: 6em;
}

/* responsive settings */

/* small devices */
/*note: too many values error in validator??? */
@media only screen and (max-device-width: 420px) and (orientation: portrait), (max-device-width: 720px) and (orientation: landscape) {

	header {
		display: none;				/*removes header from smaller screen*/
	}


	main{
		display: flex;				/* turns the whole of the main into a flex box */
		width: 100%;
		margin: 0 auto;
		flex-direction: column;		/* ensures no elements go off to the side */
	}

	
}

/* medium devices */

@media only screen and (max-device-width: 768 px) and (orientation: portrait), (max-device-width: 1024px) and (orientation: landscape) {

	main{
		display: flex;				/* turns the whole of the main into a flex box */
		width: 100%;	
		margin: 0 auto;
		flex-direction: column;		/* ensures no elements go off to the side */
	}
}



</style>

<!-- ***end of CSS*** -->

</head>
<body>
	<header>
		<h3>Ultimate Tic Tac Toe</h3>
	</header>
	<main>
		<!-- large game board -->
		<table id="largeBoard">
			<tr>
				<td class="largeTile">
					<table class="smallBoard">
						<tr>
							<td></td>
							<td></td>
							<td></td>
						</tr>
						<tr>
							<td></td>
							<td></td>
							<td></td>
						</tr>
						<tr>
							<td></td>
							<td></td>
							<td></td>
						</tr>        
					</table>
				</td>
				<td class="largeTile">
					<table class="smallBoard">
						<tr>
							<td></td>
							<td></td>
							<td></td>
						</tr>
						<tr>
							<td></td>
							<td></td>
							<td></td>
						</tr>
						<tr>
							<td></td>
							<td></td>
							<td></td>
						</tr>        
					</table>
				</td>
				<td class="largeTile">
					<table class="smallBoard">
						<tr>
							<td></td>
							<td></td>
							<td></td>
						</tr>
						<tr>
							<td></td>
							<td></td>
							<td></td>
						</tr>
						<tr>
							<td></td>
							<td></td>
							<td></td>
						</tr>        
					</table>
				</td>
			</tr>
			<tr>
				<td class="largeTile">
					<table class="smallBoard">
						<tr>
							<td></td>
							<td></td>
							<td></td>
						</tr>
						<tr>
							<td></td>
							<td></td>
							<td></td>
						</tr>
						<tr>
							<td></td>
							<td></td>
							<td></td>
						</tr>        
					</table>
				</td>
				<td class="largeTile">
					<table class="smallBoard">
						<tr>
							<td></td>
							<td></td>
							<td></td>
						</tr>
						<tr>
							<td></td>
							<td></td>
							<td></td>
						</tr>
						<tr>
							<td></td>
							<td></td>
							<td></td>
						</tr>        
					</table>
				</td>
				<td class="largeTile">
					<table class="smallBoard">
						<tr>
							<td></td>
							<td></td>
							<td></td>
						</tr>
						<tr>
							<td></td>
							<td></td>
							<td></td>
						</tr>
						<tr>
							<td></td>
							<td></td>
							<td></td>
						</tr>        
					</table>
				</td>
			</tr>
			<tr>
				<td class="largeTile">
					<table class="smallBoard">
						<tr>
							<td></td>
							<td></td>
							<td></td>
						</tr>
						<tr>
							<td></td>
							<td></td>
							<td></td>
						</tr>
						<tr>
							<td></td>
							<td></td>
							<td></td>
						</tr>        
					</table>
				</td>
				<td class="largeTile">
					<table class="smallBoard">
						<tr>
							<td></td>
							<td></td>
							<td></td>
						</tr>
						<tr>
							<td></td>
							<td></td>
							<td></td>
						</tr>
						<tr>
							<td></td>
							<td></td>
							<td></td>
						</tr>        
					</table>
				</td>
				<td class="largeTile">
					<table class="smallBoard">
						<tr>
							<td></td>
							<td></td>
							<td></td>
						</tr>
						<tr>
							<td></td>
							<td></td>
							<td></td>
						</tr>
						<tr>
							<td></td>
							<td></td>
							<td></td>
						</tr>        
					</table>
				</td>
			</tr>	      
		</table>
		
		<p>Player <span id="player">X</span>, it's your turn!</p>
		<!-- content to be displayed when game is finished -->
		<p id="winner"> </p>
		<!-- add reset button -->
		<p><button id="start">Play</button></p>			
		

	</main>
	<footer>
		<address>Jeff Pottruff, 2017 Â© SYST10199 Web Programming, Sheridan College</address>
	</footer>
<script>

/* variable declarations */


var largeBoard = document.getElementsByClassName("largeTile"); 		//largeBoard array created based on td elements with ID largeTile
var largeSelected; //used as variable to idenitfy which large cell the player is currently working in - see smallCellClicked 
var currentBoard = document.getElementsByClassName("smallBoard"); //array of small boards


var player = "X"; //representation of current player

var smallEmptyCells = [9, 9, 9, 9, 9, 9, 9, 9, 9]; //array of empty cells - one index per small board, correpsonds with large cell index (ie. smallEmptyCells[0] is the number that corresponds with the small board at largeBoard[0])
var smallGameOver = [false, false, false, false, false, false, false, false, false]; //keeps track of which smallBoards are still in progress, similar logic to smallEmptyCells
var largeEmptyCells = 9;	//keeps track of large empty cells, used to evaluate overall game status

var largeGameOver = false;	//game status of large board

var winningCombos = [[0, 1, 2], [3, 4, 5], [6, 7, 8],
				    [0, 3, 6], [1, 4, 7], [2, 5, 8],
				    [0, 4, 8], [2, 4, 6]
				    ];								//2d array of winning combinations - horizontal, vertical, diagonal 


					
/* functions */

var largeTokens;["", "", "", "", "", "", "", "", ""]; //array to keep track of winning tokens on board - IMPROVE LATER	
	
function clickLarge(cell){
		
		//highlights currently selected large cell, clears others of any previous highlighting
		//also assigns a number to the largeSelected variable (used in functions that follow)
		for (var i = 0; i < largeBoard.length; i++){
			if (cell === largeBoard[i]) {
				largeBoard[i].style.backgroundColor = "rgba(190, 190, 190, 0.5)"; //highlighting current large cell
				largeSelected = i;
			} else {
				largeBoard[i].style.backgroundColor = "white";
			}
				
		}
		
	//FIXME: need to add somethign that ensures when user clicks on a large cell that has previously been clicked, the small cell will not be selected automatically, find work around for this...or
		//OR ensure user is sent to largecell that correpsonds with last user's move (Option chosen depends on which rules are being followed)
	
	currentBoard = largeBoard[largeSelected].getElementsByTagName("td"); //referencing the smallBoard in current large cell clicked, creates an array of "td" elements
	
	
	//event listener for currentBoard (in this large cell)
	for (var i = 0; i < currentBoard.length; i++){
		currentBoard[i].addEventListener("click", function() {smallCellClicked(this);})	
	}
	//note: will now go to smallCellclicked
	
}


function smallCellClicked(cell){
	//checks to see if space clicked is open
	if (cell.innerHTML === "") {
		
		smallEmptyCells[largeSelected] -= 1; 					//removes one empty cell from emptycell counter; see smallEmptyCells array
		cell.innerHTML = player;								//changes cell clicked to player's token
		smallCheckWin();										//checks to see if this small board has a winner; see smallCheckWin function
		player = (player == "X") ? "O" : "X";					//changes player token 
		document.getElementById("player").innerHTML = player;	//change player display in HTML
		
	}
	
}

function smallCheckWin(){

	//outcome for wins
	for ( i = 0; i < winningCombos.length; i++) {
        if (currentBoard[winningCombos[i][0]].innerHTML == currentBoard[winningCombos[i][1]].innerHTML 			
            && currentBoard[winningCombos[i][1]].innerHTML == currentBoard[winningCombos[i][2]].innerHTML 
            && currentBoard[winningCombos[i][0]].innerHTML != "") {
				largeBoard[largeSelected].innerHTML = '<span class="largeToken">' + player + '</span>'; //changes large board to winning player token
					//FIXME IDEA: maybe try adding in a parentElement.removeChild (smallGame) here (see personal notes) - could maybe use same ceck win for large cells later on ??
				smallGameOver[largeSelected] = true;  
				
				//largeCheckWin();			/*PUT IN WHEN FUNCTION FIXED*/
				break;				// no longer need to evaluate
			} 
	}
	
	//outcome for draws
	if (smallEmptyCells[largeSelected] === 0 && smallGameOver[largeSelected] == false) {
		largeBoard[largeSelected].innerHTML = '<span class="largeToken">-</span>';	// changes large board to blocked square
		smallGameOver[largeSelected] = true;
		//largeCheckWin();					/*PUT IN WHEN FUNCTION FIXED*/
		}
}



/*FIXME - won't pick up winning combos/draws on largeBoard - displays message at wrong time*/

function largeCheckWin(){
	//NOTE: clarify logic for this 'for statement' taken from: http://codepen.io/ProfWendi/pen/MJyRyB?editors=0110 , modified to fit exisitng code			
    console.log("in large check win");
	for ( i = 0; i < winningCombos.length; i++) {
        if (largeBoard[winningCombos[i][0]].innerHTML == largeBoard[winningCombos[i][1]].innerHTML 			
            && largeBoard[winningCombos[i][1]].innerHTML == largeBoard[winningCombos[i][2]].innerHTML 
            && largeBoard[winningCombos[i][0]].innerHTML != '') {      
				document.getElementById("winner").innerHTML = "Game Over! Player " + player + " wins!";
				largeGameOver = true;    
				break;				// no longer need to evaluate
			} 
	}
	
	//outcome for draws
	if (largeEmptyCells === 0 && largeGameOver == false) {
		document.getElementById("winner").innerHTML = "Game over. It's a draw!"; /*MODIFY*/
		
		largeGameOver[largeSelected] = true;
		
		}
}



/* events */

//listens for click on large cells - shows which large cell was selected via function
	for (var i = 0; i < largeBoard.length; i++){
			largeBoard[i].addEventListener("click", function() {clickLarge(this);});	//note: passing in this object(ie. cell clicked) to anonymous function that passes it into the clickLarge function
	}







</script>
</body>
</html>